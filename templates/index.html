<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tic Tac Toe - Dark Mode</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Tic Tac Toe</h1>
    <div class="board" id="board">
        {% for cell in board %}
            <div class="cell" data-index="{{ loop.index0 }}">{{ cell if cell in ['X','O'] else '' }}</div>
        {% endfor %}
    </div>
    <div class="info">
        <p id="status">Player X's turn</p>
        <button onclick="resetGame()">Reset Game</button>
    </div>

    <script>
        const boardDiv = document.getElementById('board');
        const status = document.getElementById('status');

        boardDiv.addEventListener('click', async (e) => {
            if (!e.target.classList.contains('cell')) return;

            const index = e.target.dataset.index;

            const res = await fetch("/play", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ index: index })
            });

            const data = await res.json();

            if (data.status === "ok") {
                const cells = document.querySelectorAll(".cell");
                data.board.forEach((val, i) => {
                    cells[i].textContent = val === "X" || val === "O" ? val : "";
                });

                if (data.winner) {
                    status.textContent = data.winner === "Draw" ? "It's a draw!" : `${data.winner} wins! ðŸŽ‰`;
                } else {
                    status.textContent = `Player ${data.current_player}'s turn`;
                }
            }
        });

        async function resetGame() {
            const res = await fetch("/reset", { method: "POST" });
            const data = await res.json();
            const cells = document.querySelectorAll(".cell");
            cells.forEach(cell => cell.textContent = "");
            status.textContent = "Player X's turn";
        }
    </script>
</body>
</html>
